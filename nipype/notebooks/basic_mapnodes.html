
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MapNode &#8212; MRI analysis in Python using Nipype, Nilearn and more</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"N": "\\mathbb{N}", "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"]}}, "tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="JoinNode, synchronize and itersource" href="basic_joinnodes.html" />
    <link rel="prev" title="Iterables" href="basic_iteration.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/nipy_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">MRI analysis in Python using Nipype, Nilearn and more</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../index.html">
   Welcome!
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../overview.html">
   Workshop overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../setup.html">
   Setup for the workshop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outline.html">
   Outline
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../prerequisites.html">
   Course prerequisites
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../prerequisites/intro_to_shell.html">
     Introduction to the (unix) command line: bash
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../prerequisites/intro_to_git_and_github.html">
     Introduction to git and github
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../prerequisites/intro_jupyter.html">
     Introduction to the jupyter ecosystem &amp; notebooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../prerequisites/intro_python.html">
     Introduction to Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../prerequisites/python_numpy.html">
     Introduction to NumPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../prerequisites/python_scipy.html">
     Introduction to SciPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../prerequisites/python_visualization.html">
     Introduction to Visualization in python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../prerequisites/intro_statistics.html">
     Introduction to Statistics in python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../prerequisites/python_scikit.html">
     Introduction to scikit-learn &amp; scikit-image
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../data/data.html">
   Basics in data handling
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data/image_manipulation_nibabel.html">
     Using Python for neuroimaging data - NiBabel
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../data/image_manipulation_nilearn.html">
     Using Python for neuroimaging data - Nilearn
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../nipype_overview.html">
   Nipype
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../nipype_intro.html">
     Introduction to Nipype
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="introduction_showcase.html">
       Nipype Showcase
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="introduction_quickstart.html">
       Nipype Quickstart
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="introduction_quickstart_non-neuroimaging.html">
       Nipype Quickstart - non-imaging
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../nipype_basics.html">
     Basic concepts
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="basic_interfaces.html">
       Interfaces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_nodes.html">
       Nodes
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_workflow.html">
       Workflows
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_graph_visualization.html">
       Graph Visualization
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_data_input.html">
       Data Input
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_data_input_bids.html">
       Data input for BIDS datasets
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_data_output.html">
       Data Output
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_plugins.html">
       Using Nipype Plugins
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_function_interface.html">
       Function Interface
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_iteration.html">
       Iterables
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       MapNode
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_joinnodes.html">
       JoinNode, synchronize and itersource
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_debug.html">
       Debugging Nipype Workflows
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="basic_execution_configuration.html">
       Execution Configuration Options
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../nipype_examples.html">
     Example workflows
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
    <label for="toctree-checkbox-6">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="example_preprocessing.html">
       Example 1: Preprocessing Workflow
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="example_1stlevel.html">
       Example 2: 1st-level Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="example_normalize.html">
       Example 3: Normalize data to MNI template
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="example_2ndlevel.html">
       Example 4: 2nd-level Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="handson_preprocessing.html">
       Hands-on 1: How to create a fMRI preprocessing workflow
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="handson_analysis.html">
       Hands-on 2: How to create a fMRI analysis workflow
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../nipype_advanced.html">
     Advanced concepts
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="advanced_create_interfaces.html">
       Create interfaces
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="advanced_interfaces_caching.html">
       Interface caching
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="advanced_nipypecli.html">
       Nipype Command Line Interface
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="advanced_aws.html">
       Using Nipype with Amazon Web Services (AWS)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="advanced_sphinx_ext.html">
       Sphinx extensions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="advanced_spmmcr.html">
       Using SPM with MATLAB Common Runtime (MCR)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="advanced_mipav.html">
       Using MIPAV, JIST, and CBS Tools
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../nipype_resources.html">
     Resources
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="resources_installation.html">
       Download and install
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="resources_help.html">
       Where to find help
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../advanced.html">
   Advanced and specialized analyses
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../advanced/pybids.html">
     Introduction to
     <code class="docutils literal notranslate">
      <span class="pre">
       pybids
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../advanced/statistical_analyses_MRI.html">
     Nilearn GLM: statistical analyses of MRI in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../advanced/functional_connectivity.html">
     Functional connectivity and resting state
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../advanced/machine_learning_preparation.html">
     Preparation Machine Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../advanced/machine_learning_nilearn.html">
     MVPA and Searchlight with
     <code class="docutils literal notranslate">
      <span class="pre">
       nilearn
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../advanced/machine_learning_keras.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       TensorFlow
      </span>
     </code>
     /
     <code class="docutils literal notranslate">
      <span class="pre">
       Keras
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../advanced/Predicting_age_with_machine_learning.html">
     Machine learning to predict age from rs-fmri
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../break.html">
   Yoga and/or dance break
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../CoC.html">
   Code of Conduct
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/nipype/notebooks/basic_mapnodes.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/PeerHerholz/workshop_weizmann"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/PeerHerholz/workshop_weizmann/issues/new?title=Issue%20on%20page%20%2Fnipype/notebooks/basic_mapnodes.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/PeerHerholz/workshop_weizmann/edit/main/workshop/nipype/notebooks/basic_mapnodes.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/PeerHerholz/workshop_weizmann/main?urlpath=tree/workshop/nipype/notebooks/basic_mapnodes.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   MapNode
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iterfield">
     <code class="docutils literal notranslate">
      <span class="pre">
       iterfield
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-is-this-important">
   Why is this important?
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-1">
     Exercise 1
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="mapnode">
<h1>MapNode<a class="headerlink" href="#mapnode" title="Permalink to this headline">¶</a></h1>
<p>If you want to iterate over a list of inputs, but need to feed all iterated outputs afterward as one input (an array) to the next node, you need to use a <strong><code class="docutils literal notranslate"><span class="pre">MapNode</span></code></strong>. A <code class="docutils literal notranslate"><span class="pre">MapNode</span></code> is quite similar to a normal <code class="docutils literal notranslate"><span class="pre">Node</span></code>, but it can take a list of inputs and operate over each input separately, ultimately returning a list of outputs.</p>
<p>Imagine that you have a list of items (let’s say files) and you want to execute the same node on them (for example some smoothing or masking). Some nodes accept multiple files and do exactly the same thing on them, but some don’t (they expect only one file). <code class="docutils literal notranslate"><span class="pre">MapNode</span></code> can solve this problem. Imagine you have the following workflow:</p>
<img src="../static/images/mapnode.png"  width="325">
<p>Node <code class="docutils literal notranslate"><span class="pre">A</span></code> outputs a list of files, but node <code class="docutils literal notranslate"><span class="pre">B</span></code> accepts only one file. Additionally, <code class="docutils literal notranslate"><span class="pre">C</span></code> expects a list of files. What you would like is to run <code class="docutils literal notranslate"><span class="pre">B</span></code> for every file in the output of <code class="docutils literal notranslate"><span class="pre">A</span></code> and collect the results as a list and feed it to <code class="docutils literal notranslate"><span class="pre">C</span></code>. Something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nipype</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">MapNode</span><span class="p">,</span> <span class="n">Workflow</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">A</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">MapNode</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">B</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">C</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>

<span class="n">my_workflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_workflow&quot;</span><span class="p">)</span>
<span class="n">my_workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,[(</span><span class="s1">&#39;out_files&#39;</span><span class="p">,</span><span class="s1">&#39;in_file&#39;</span><span class="p">)]),</span>
                     <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,[(</span><span class="s1">&#39;out_file&#39;</span><span class="p">,</span><span class="s1">&#39;in_files&#39;</span><span class="p">)])</span>
                     <span class="p">])</span>
</pre></div>
</div>
<p>Let’s demonstrate this with a simple function interface:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nipype</span> <span class="kn">import</span> <span class="n">Function</span>
<span class="k">def</span> <span class="nf">square_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">square</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;f_x&quot;</span><span class="p">],</span> <span class="n">square_func</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We see that this function just takes a numeric input and returns its squared value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">square</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">f_x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
</div>
</div>
<p>What if we wanted to square a list of numbers? We could set an iterable and just split up the workflow in multiple sub-workflows. But say we were making a simple workflow that squared a list of numbers and then summed them. The sum node would expect a list, but using an iterable would make a bunch of sum nodes, and each would get one number from the list. The solution here is to use a <code class="docutils literal notranslate"><span class="pre">MapNode</span></code>.</p>
<div class="section" id="iterfield">
<h2><code class="docutils literal notranslate"><span class="pre">iterfield</span></code><a class="headerlink" href="#iterfield" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">MapNode</span></code> constructor has a field called <code class="docutils literal notranslate"><span class="pre">iterfield</span></code>, which tells it what inputs should be expecting a list.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nipype</span> <span class="kn">import</span> <span class="n">MapNode</span>
<span class="n">square_node</span> <span class="o">=</span> <span class="n">MapNode</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;square&quot;</span><span class="p">,</span> <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">square_node</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">square_node</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>211017-17:58:52,265 nipype.workflow INFO:
	 [Node] Setting-up &quot;square&quot; in &quot;/tmp/tmp52eg73s9/square&quot;.
211017-17:58:52,276 nipype.workflow INFO:
	 [Node] Setting-up &quot;_square0&quot; in &quot;/tmp/tmp52eg73s9/square/mapflow/_square0&quot;.
211017-17:58:52,280 nipype.workflow INFO:
	 [Node] Running &quot;_square0&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,305 nipype.workflow INFO:
	 [Node] Finished &quot;_square0&quot;.
211017-17:58:52,309 nipype.workflow INFO:
	 [Node] Setting-up &quot;_square1&quot; in &quot;/tmp/tmp52eg73s9/square/mapflow/_square1&quot;.
211017-17:58:52,324 nipype.workflow INFO:
	 [Node] Running &quot;_square1&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,331 nipype.workflow INFO:
	 [Node] Finished &quot;_square1&quot;.
211017-17:58:52,336 nipype.workflow INFO:
	 [Node] Setting-up &quot;_square2&quot; in &quot;/tmp/tmp52eg73s9/square/mapflow/_square2&quot;.
211017-17:58:52,344 nipype.workflow INFO:
	 [Node] Running &quot;_square2&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,351 nipype.workflow INFO:
	 [Node] Finished &quot;_square2&quot;.
211017-17:58:52,354 nipype.workflow INFO:
	 [Node] Setting-up &quot;_square3&quot; in &quot;/tmp/tmp52eg73s9/square/mapflow/_square3&quot;.
211017-17:58:52,361 nipype.workflow INFO:
	 [Node] Running &quot;_square3&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,370 nipype.workflow INFO:
	 [Node] Finished &quot;_square3&quot;.
211017-17:58:52,374 nipype.workflow INFO:
	 [Node] Finished &quot;square&quot;.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">f_x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 4, 9]
</pre></div>
</div>
</div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">iterfield</span></code> can take a list of names, you can operate over multiple sets of data, as long as they’re the same length. The values in each list will be paired; it does not compute a combinatoric product of the lists.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">power_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">power</span> <span class="o">=</span> <span class="n">Function</span><span class="p">([</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;f_xy&quot;</span><span class="p">],</span> <span class="n">power_func</span><span class="p">)</span>
<span class="n">power_node</span> <span class="o">=</span> <span class="n">MapNode</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
<span class="n">power_node</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">power_node</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">power_node</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>211017-17:58:52,426 nipype.workflow INFO:
	 [Node] Setting-up &quot;power&quot; in &quot;/tmp/tmpk4mrv4ue/power&quot;.
211017-17:58:52,437 nipype.workflow INFO:
	 [Node] Setting-up &quot;_power0&quot; in &quot;/tmp/tmpk4mrv4ue/power/mapflow/_power0&quot;.
211017-17:58:52,444 nipype.workflow INFO:
	 [Node] Running &quot;_power0&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,452 nipype.workflow INFO:
	 [Node] Finished &quot;_power0&quot;.
211017-17:58:52,454 nipype.workflow INFO:
	 [Node] Setting-up &quot;_power1&quot; in &quot;/tmp/tmpk4mrv4ue/power/mapflow/_power1&quot;.
211017-17:58:52,463 nipype.workflow INFO:
	 [Node] Running &quot;_power1&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,470 nipype.workflow INFO:
	 [Node] Finished &quot;_power1&quot;.
211017-17:58:52,473 nipype.workflow INFO:
	 [Node] Setting-up &quot;_power2&quot; in &quot;/tmp/tmpk4mrv4ue/power/mapflow/_power2&quot;.
211017-17:58:52,477 nipype.workflow INFO:
	 [Node] Running &quot;_power2&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,484 nipype.workflow INFO:
	 [Node] Finished &quot;_power2&quot;.
211017-17:58:52,487 nipype.workflow INFO:
	 [Node] Setting-up &quot;_power3&quot; in &quot;/tmp/tmpk4mrv4ue/power/mapflow/_power3&quot;.
211017-17:58:52,495 nipype.workflow INFO:
	 [Node] Running &quot;_power3&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,505 nipype.workflow INFO:
	 [Node] Finished &quot;_power3&quot;.
211017-17:58:52,510 nipype.workflow INFO:
	 [Node] Finished &quot;power&quot;.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">f_xy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 1, 4, 27]
</pre></div>
</div>
</div>
</div>
<p>But not every input needs to be an iterfield.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">power_node</span> <span class="o">=</span> <span class="n">MapNode</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
<span class="n">power_node</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">power_node</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">power_node</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>211017-17:58:52,536 nipype.workflow INFO:
	 [Node] Setting-up &quot;power&quot; in &quot;/tmp/tmpks_3y7g6/power&quot;.
211017-17:58:52,547 nipype.workflow INFO:
	 [Node] Setting-up &quot;_power0&quot; in &quot;/tmp/tmpks_3y7g6/power/mapflow/_power0&quot;.
211017-17:58:52,550 nipype.workflow INFO:
	 [Node] Running &quot;_power0&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,557 nipype.workflow INFO:
	 [Node] Finished &quot;_power0&quot;.
211017-17:58:52,561 nipype.workflow INFO:
	 [Node] Setting-up &quot;_power1&quot; in &quot;/tmp/tmpks_3y7g6/power/mapflow/_power1&quot;.
211017-17:58:52,567 nipype.workflow INFO:
	 [Node] Running &quot;_power1&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,577 nipype.workflow INFO:
	 [Node] Finished &quot;_power1&quot;.
211017-17:58:52,580 nipype.workflow INFO:
	 [Node] Setting-up &quot;_power2&quot; in &quot;/tmp/tmpks_3y7g6/power/mapflow/_power2&quot;.
211017-17:58:52,585 nipype.workflow INFO:
	 [Node] Running &quot;_power2&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,595 nipype.workflow INFO:
	 [Node] Finished &quot;_power2&quot;.
211017-17:58:52,599 nipype.workflow INFO:
	 [Node] Setting-up &quot;_power3&quot; in &quot;/tmp/tmpks_3y7g6/power/mapflow/_power3&quot;.
211017-17:58:52,604 nipype.workflow INFO:
	 [Node] Running &quot;_power3&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-17:58:52,614 nipype.workflow INFO:
	 [Node] Finished &quot;_power3&quot;.
211017-17:58:52,619 nipype.workflow INFO:
	 [Node] Finished &quot;power&quot;.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">f_xy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 8, 27]
</pre></div>
</div>
</div>
</div>
<p>As in the case of <code class="docutils literal notranslate"><span class="pre">iterables</span></code>, each underlying <code class="docutils literal notranslate"><span class="pre">MapNode</span></code> execution can happen in <strong>parallel</strong>. Hopefully, you see how these tools allow you to write flexible, reusable workflows that will help you process large amounts of data efficiently and reproducibly.</p>
<p>In more advanced applications it is useful to be able to iterate over items of nested lists (for example <code class="docutils literal notranslate"><span class="pre">[[1,2],[3,4]]</span></code>). MapNode allows you to do this with the “nested=True” parameter. Outputs will preserve the same nested structure as the inputs.</p>
</div>
</div>
<div class="section" id="why-is-this-important">
<h1>Why is this important?<a class="headerlink" href="#why-is-this-important" title="Permalink to this headline">¶</a></h1>
<p>Let’s consider we have multiple functional images (A) and each of them should be motioned corrected (B1, B2, B3,..). But afterward, we want to put them all together into a GLM, i.e. the input for the GLM should be an array of [B1, B2, B3, …]. <a class="reference internal" href="basic_iteration.html"><span class="doc std std-doc">Iterables</span></a> can’t do that. They would split up the pipeline. Therefore, we need <strong>MapNodes</strong>.</p>
<img src="../static/images/mapnode.png"  width="300">
<p>Let’s look at a simple example, where we want to motion correct two functional images. For this we need two nodes:</p>
<ul class="simple">
<li><p>Gunzip, to unzip the files (plural)</p></li>
<li><p>Realign, to do the motion correction</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nipype.algorithms.misc</span> <span class="kn">import</span> <span class="n">Gunzip</span>
<span class="kn">from</span> <span class="nn">nipype.interfaces.spm</span> <span class="kn">import</span> <span class="n">Realign</span>
<span class="kn">from</span> <span class="nn">nipype</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">MapNode</span><span class="p">,</span> <span class="n">Workflow</span>

<span class="c1"># Here we specify a list of files (for this tutorial, we just add the same file twice)</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/data/ds000114/sub-01/ses-test/func/sub-01_ses-test_task-fingerfootlips_bold.nii.gz&#39;</span><span class="p">,</span>
         <span class="s1">&#39;/data/ds000114/sub-01/ses-test/func/sub-01_ses-test_task-fingerfootlips_bold.nii.gz&#39;</span><span class="p">]</span>

<span class="n">realign</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">Realign</span><span class="p">(</span><span class="n">register_to_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
               <span class="n">name</span><span class="o">=</span><span class="s1">&#39;motion_correction&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If we try to specify the input for the <strong>Gunzip</strong> node with a simple <strong>Node</strong>, we get the following error:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gunzip</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">Gunzip</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gunzip&#39;</span><span class="p">,)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">gunzip</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="n">files</span>
<span class="k">except</span><span class="p">(</span><span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">if</span> <span class="s2">&quot;TraitError&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TraitError:&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TraitError: The &#39;in_file&#39; trait of a GunzipInputSpec instance must be a pathlike object or string representing an existing file, but a value of &quot;[&#39;/data/ds000114/sub-01/ses-test/func/sub-01_ses-test_task-fingerfootlips_bold.nii.gz&#39;, &#39;/data/ds000114/sub-01/ses-test/func/sub-01_ses-test_task-fingerfootlips_bold.nii.gz&#39;]&quot; &lt;class &#39;str&#39;&gt; was specified.
</pre></div>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>TraitError: The <span class="s1">&#39;in_file&#39;</span> trait of a GunzipInputSpec instance must be an existing file name, but a value of <span class="o">[</span><span class="s1">&#39;/data/ds000114/sub-01/ses-test/func/sub-01_ses-test_task-fingerfootlips_bold.nii.gz&#39;</span>, <span class="s1">&#39;/data/ds000114/sub-01/ses-test/func/sub-01_ses-test_task-fingerfootlips_bold.nii.gz&#39;</span><span class="o">]</span> &lt;class <span class="s1">&#39;list&#39;</span>&gt; was specified.
</pre></div>
</div>
<p>But if we do it with a <strong>MapNode</strong>, it works:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gunzip</span> <span class="o">=</span> <span class="n">MapNode</span><span class="p">(</span><span class="n">Gunzip</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gunzip&#39;</span><span class="p">,</span>
                 <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">gunzip</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="n">files</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we just have to create a workflow, connect the nodes and we can run it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mcflow</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;realign_with_spm&#39;</span><span class="p">)</span>
<span class="n">mcflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">gunzip</span><span class="p">,</span> <span class="s1">&#39;out_file&#39;</span><span class="p">,</span> <span class="n">realign</span><span class="p">,</span> <span class="s1">&#39;in_files&#39;</span><span class="p">)</span>
<span class="n">mcflow</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="s1">&#39;/output&#39;</span>
<span class="n">mcflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;MultiProc&#39;</span><span class="p">,</span> <span class="n">plugin_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_procs&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>211017-17:58:53,160 nipype.workflow INFO:
	 Workflow realign_with_spm settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
211017-17:58:53,165 nipype.workflow INFO:
	 Running in parallel.
211017-17:58:53,169 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 1.75/1.75, Free processors: 4/4.
211017-17:58:55,175 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 2 jobs ready. Free memory (GB): 1.75/1.75, Free processors: 4/4.
211017-17:58:55,251 nipype.workflow INFO:
	 [Node] Setting-up &quot;_gunzip0&quot; in &quot;/output/realign_with_spm/gunzip/mapflow/_gunzip0&quot;.
211017-17:58:55,251 nipype.workflow INFO:
	 [Node] Setting-up &quot;_gunzip1&quot; in &quot;/output/realign_with_spm/gunzip/mapflow/_gunzip1&quot;.
211017-17:58:55,258 nipype.workflow INFO:
	 [Node] Running &quot;_gunzip0&quot; (&quot;nipype.algorithms.misc.Gunzip&quot;)
211017-17:58:55,261 nipype.workflow INFO:
	 [Node] Running &quot;_gunzip1&quot; (&quot;nipype.algorithms.misc.Gunzip&quot;)
211017-17:58:55,744 nipype.workflow INFO:
	 [Node] Finished &quot;_gunzip0&quot;.
211017-17:58:55,744 nipype.workflow INFO:
	 [Node] Finished &quot;_gunzip1&quot;.
211017-17:58:57,179 nipype.workflow INFO:
	 [Job 2] Completed (_gunzip0).
211017-17:58:57,183 nipype.workflow INFO:
	 [Job 3] Completed (_gunzip1).
211017-17:58:57,188 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 1.75/1.75, Free processors: 4/4.
211017-17:58:57,267 nipype.workflow INFO:
	 [Node] Setting-up &quot;realign_with_spm.gunzip&quot; in &quot;/output/realign_with_spm/gunzip&quot;.
211017-17:58:57,281 nipype.workflow INFO:
	 [Node] Setting-up &quot;_gunzip0&quot; in &quot;/output/realign_with_spm/gunzip/mapflow/_gunzip0&quot;.
211017-17:58:57,292 nipype.workflow INFO:
	 [Node] Cached &quot;_gunzip0&quot; - collecting precomputed outputs
211017-17:58:57,297 nipype.workflow INFO:
	 [Node] &quot;_gunzip0&quot; found cached.
211017-17:58:57,301 nipype.workflow INFO:
	 [Node] Setting-up &quot;_gunzip1&quot; in &quot;/output/realign_with_spm/gunzip/mapflow/_gunzip1&quot;.
211017-17:58:57,312 nipype.workflow INFO:
	 [Node] Cached &quot;_gunzip1&quot; - collecting precomputed outputs
211017-17:58:57,316 nipype.workflow INFO:
	 [Node] &quot;_gunzip1&quot; found cached.
211017-17:58:57,327 nipype.workflow INFO:
	 [Node] Finished &quot;realign_with_spm.gunzip&quot;.
211017-17:58:59,139 nipype.workflow INFO:
	 [Job 0] Completed (realign_with_spm.gunzip).
211017-17:58:59,143 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 1 jobs ready. Free memory (GB): 1.75/1.75, Free processors: 4/4.
211017-17:58:59,200 nipype.workflow INFO:
	 [Node] Setting-up &quot;realign_with_spm.motion_correction&quot; in &quot;/output/realign_with_spm/motion_correction&quot;.
211017-17:58:59,358 nipype.workflow INFO:
	 [Node] Running &quot;motion_correction&quot; (&quot;nipype.interfaces.spm.preprocess.Realign&quot;)
211017-17:59:01,140 nipype.workflow INFO:
	 [MultiProc] Running 1 tasks, and 0 jobs ready. Free memory (GB): 1.55/1.75, Free processors: 3/4.
                     Currently running:
                       * realign_with_spm.motion_correction
211017-18:00:26,608 nipype.workflow INFO:
	 [Node] Finished &quot;realign_with_spm.motion_correction&quot;.
211017-18:00:27,144 nipype.workflow INFO:
	 [Job 1] Completed (realign_with_spm.motion_correction).
211017-18:00:27,148 nipype.workflow INFO:
	 [MultiProc] Running 0 tasks, and 0 jobs ready. Free memory (GB): 1.75/1.75, Free processors: 4/4.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;networkx.classes.digraph.DiGraph at 0x7fe5f634e6d0&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="exercise-1">
<h2>Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this headline">¶</a></h2>
<p>Create a workflow to calculate a sum of factorials of numbers from a range between <span class="math notranslate nohighlight">\(n_{min}\)</span> and <span class="math notranslate nohighlight">\(n_{max}\)</span>, i.e.:</p>
<div class="math notranslate nohighlight">
\[\sum _{k=n_{min}}^{n_{max}} k! = 0! + 1! +2! + 3! + \cdots\]</div>
<p>if <span class="math notranslate nohighlight">\(n_{min}=0\)</span> and <span class="math notranslate nohighlight">\(n_{max}=3\)</span>
$<span class="math notranslate nohighlight">\(\sum _{k=0}^{3} k! = 0! + 1! +2! + 3!  =  1 + 1 + 2 + 6 = 10\)</span>$</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">Node</span></code> for a function that creates a list of integers and a function that sums everything at the end. Use <code class="docutils literal notranslate"><span class="pre">MapNode</span></code> to calculate factorials.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#write your solution here</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nipype</span> <span class="kn">import</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">Node</span><span class="p">,</span> <span class="n">MapNode</span><span class="p">,</span> <span class="n">Function</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">range_fun</span><span class="p">(</span><span class="n">n_min</span><span class="p">,</span> <span class="n">n_max</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_min</span><span class="p">,</span> <span class="n">n_max</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="c1"># print(&quot;FACTORIAL, {}&quot;.format(n))</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">summing</span><span class="p">(</span><span class="n">terms</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">terms</span><span class="p">)</span>

<span class="n">wf_ex1</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">(</span><span class="s1">&#39;ex1&#39;</span><span class="p">)</span>
<span class="n">wf_ex1</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

<span class="n">range_nd</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">Function</span><span class="p">(</span><span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;n_min&#39;</span><span class="p">,</span> <span class="s1">&#39;n_max&#39;</span><span class="p">],</span>
                         <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;range_list&#39;</span><span class="p">],</span>
                         <span class="n">function</span><span class="o">=</span><span class="n">range_fun</span><span class="p">),</span> 
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;range_list&#39;</span><span class="p">)</span>

<span class="n">factorial_nd</span> <span class="o">=</span> <span class="n">MapNode</span><span class="p">(</span><span class="n">Function</span><span class="p">(</span><span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span>
                                <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fact_out&#39;</span><span class="p">],</span>
                                <span class="n">function</span><span class="o">=</span><span class="n">factorial</span><span class="p">),</span> 
                       <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span>
                       <span class="n">name</span><span class="o">=</span><span class="s1">&#39;factorial&#39;</span><span class="p">)</span>

<span class="n">summing_nd</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">Function</span><span class="p">(</span><span class="n">input_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;terms&#39;</span><span class="p">],</span>
                           <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sum_out&#39;</span><span class="p">],</span>
                           <span class="n">function</span><span class="o">=</span><span class="n">summing</span><span class="p">),</span> 
                  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;summing&#39;</span><span class="p">)</span>


<span class="n">range_nd</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n_min</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">range_nd</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n_max</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">wf_ex1</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">([</span><span class="n">range_nd</span><span class="p">])</span>
<span class="n">wf_ex1</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">range_nd</span><span class="p">,</span> <span class="s1">&#39;range_list&#39;</span><span class="p">,</span> <span class="n">factorial_nd</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
<span class="n">wf_ex1</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">factorial_nd</span><span class="p">,</span> <span class="s1">&#39;fact_out&#39;</span><span class="p">,</span> <span class="n">summing_nd</span><span class="p">,</span> <span class="s2">&quot;terms&quot;</span><span class="p">)</span>


<span class="n">eg</span> <span class="o">=</span> <span class="n">wf_ex1</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>211017-18:00:29,156 nipype.workflow INFO:
	 Workflow ex1 settings: [&#39;check&#39;, &#39;execution&#39;, &#39;logging&#39;, &#39;monitoring&#39;]
211017-18:00:29,190 nipype.workflow INFO:
	 Running serially.
211017-18:00:29,191 nipype.workflow INFO:
	 [Node] Setting-up &quot;ex1.range_list&quot; in &quot;/home/neuro/workshop_weizmann/workshop/nipype/notebooks/ex1/range_list&quot;.
211017-18:00:29,213 nipype.workflow INFO:
	 [Node] Running &quot;range_list&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-18:00:29,252 nipype.workflow INFO:
	 [Node] Finished &quot;ex1.range_list&quot;.
211017-18:00:29,253 nipype.workflow INFO:
	 [Node] Setting-up &quot;ex1.factorial&quot; in &quot;/home/neuro/workshop_weizmann/workshop/nipype/notebooks/ex1/factorial&quot;.
211017-18:00:29,290 nipype.workflow INFO:
	 [Node] Setting-up &quot;_factorial0&quot; in &quot;/home/neuro/workshop_weizmann/workshop/nipype/notebooks/ex1/factorial/mapflow/_factorial0&quot;.
211017-18:00:29,313 nipype.workflow INFO:
	 [Node] Running &quot;_factorial0&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-18:00:29,353 nipype.workflow INFO:
	 [Node] Finished &quot;_factorial0&quot;.
211017-18:00:29,362 nipype.workflow INFO:
	 [Node] Setting-up &quot;_factorial1&quot; in &quot;/home/neuro/workshop_weizmann/workshop/nipype/notebooks/ex1/factorial/mapflow/_factorial1&quot;.
211017-18:00:29,385 nipype.workflow INFO:
	 [Node] Running &quot;_factorial1&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-18:00:29,418 nipype.workflow INFO:
	 [Node] Finished &quot;_factorial1&quot;.
211017-18:00:29,426 nipype.workflow INFO:
	 [Node] Setting-up &quot;_factorial2&quot; in &quot;/home/neuro/workshop_weizmann/workshop/nipype/notebooks/ex1/factorial/mapflow/_factorial2&quot;.
211017-18:00:29,449 nipype.workflow INFO:
	 [Node] Running &quot;_factorial2&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-18:00:29,491 nipype.workflow INFO:
	 [Node] Finished &quot;_factorial2&quot;.
211017-18:00:29,529 nipype.workflow INFO:
	 [Node] Setting-up &quot;_factorial3&quot; in &quot;/home/neuro/workshop_weizmann/workshop/nipype/notebooks/ex1/factorial/mapflow/_factorial3&quot;.
211017-18:00:29,637 nipype.workflow INFO:
	 [Node] Running &quot;_factorial3&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-18:00:29,736 nipype.workflow INFO:
	 [Node] Finished &quot;_factorial3&quot;.
211017-18:00:29,771 nipype.workflow INFO:
	 [Node] Finished &quot;ex1.factorial&quot;.
211017-18:00:29,772 nipype.workflow INFO:
	 [Node] Setting-up &quot;ex1.summing&quot; in &quot;/home/neuro/workshop_weizmann/workshop/nipype/notebooks/ex1/summing&quot;.
211017-18:00:29,806 nipype.workflow INFO:
	 [Node] Running &quot;summing&quot; (&quot;nipype.interfaces.utility.wrappers.Function&quot;)
211017-18:00:29,849 nipype.workflow INFO:
	 [Node] Finished &quot;ex1.summing&quot;.
</pre></div>
</div>
</div>
</div>
<p>let’s print all nodes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eg</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NodeView((ex1.range_list, ex1.factorial, ex1.summing))
</pre></div>
</div>
</div>
</div>
<p>the final result should be 10:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">eg</span><span class="o">.</span><span class="n">nodes</span><span class="p">())[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">outputs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>sum_out = 10
</pre></div>
</div>
</div>
</div>
<p>we can also check the results of two other nodes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">eg</span><span class="o">.</span><span class="n">nodes</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">eg</span><span class="o">.</span><span class="n">nodes</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>range_list = [0, 1, 2, 3]

Bunch(fact_out=[1, 1, 2, 6])
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./nipype/notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="basic_iteration.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Iterables</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="basic_joinnodes.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">JoinNode, synchronize and itersource</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Peer Herholz<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>